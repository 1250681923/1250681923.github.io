{"title":"基于R推荐系统搭建","uid":"53b940f6ea7d5afb2d81c3c681083d3b","slug":"基于R推荐系统搭建","date":"2022-03-21T14:23:39.000Z","updated":"2024-11-06T02:24:29.752Z","comments":true,"path":"api/articles/基于R推荐系统搭建.json","keywords":null,"cover":"/img/ai.jpg","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>首先，R语言牛皮之处就不过多阐述，总之很方便很方便。R语言就是为了数据处理而生的，可以轻松链接数据库，可以轻松对数据进行处理和分析。</p>\n<p>这篇博客主要归纳一下如何使用R语言搭建一个简单的推荐系统。首先导入包：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">#install.packages(&quot;RJDBC&quot;) 如果第一次使用，要下载所需要的包，然后使用。\nlibrary(RJDBC)\n#以下是一些画图使用的包，还有一些机器学习算法。\nlibrary(rvest)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(scales)\nlibrary(maps)\nlibrary(mapproj)\nlibrary(plotly)\nlibrary(rpart)\nlibrary(rpart.plot)\nlibrary(C50)\nlibrary(tree)\nlibrary(ROCR)\nlibrary(randomForest)\nlibrary(e1071)\nlibrary(naivebayes)\nlibrary(nnet)\nlibrary(kknn)</code></pre>\n<h2 id=\"链接Oracle数据库\"><a href=\"#链接Oracle数据库\" class=\"headerlink\" title=\"链接Oracle数据库\"></a>链接Oracle数据库</h2><p>如果有小伙伴想复现这个项目，可以直接去我的github下载csv数据文件，用R导入csv数据也是一样的效果(Imm..表只给出了前几百条数据，因为数据文件太大，无法上传仓库)：</p>\n<p><a href=\"https://github.com/1250681923/DataAnalyseMBDS.git\">项目仓库</a></p>\n<p>虽然有些公司可能节约成本选择使用Mysql，但是学习Oracle还是非常有必要的。在顶端DBA大师眼中，能在PDB中进行协作的Oracle有着无可取代的天然优势。更别提我们可以通过Hive工具创建Oracle内外表后使用Oracle sql, Oracle Nosql, Hadoop HDFS, MongDB搭建数据湖。这对企业的大数据架构的整合有着巨大的价值。</p>\n<p>在此之前需要下载jdbc的jar包：<a href=\"https://github.com/1250681923/picture.git\">点击链接进行下载drives文件</a></p>\n<p>链接配置规则： </p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">conn&lt;-dbConnect(drv,“jdbc:oracle:thin:@主机IP:1521:数据库名称”,“用户名称”,“密码”)</code></pre>\n<p>远程链接：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">drv &lt;- RJDBC::JDBC(driverClass &#x3D; &quot;oracle.jdbc.OracleDriver&quot;, classPath &#x3D;  Sys.glob(&quot;C:&#x2F;Users&#x2F;12506&#x2F;OneDrive&#x2F;Desktop&#x2F;ESTIA3A&#x2F;R&#x2F;Oracle&#x2F;drivers&#x2F;*&quot;))\n\nconn &lt;- dbConnect(drv, &quot;jdbc:oracle:thin:@(DESCRIPTION&#x3D;(ADDRESS&#x3D;(PROTOCOL&#x3D;TCP)(HOST&#x3D;144.21.67.201)(PORT&#x3D;1521))(CONNECT_DATA&#x3D;(SERVICE_NAME&#x3D;pdbest21.631174089.oraclecloud.internal)))&quot;, &quot;ZHANG2B20&quot;, &quot;ZHANG2B2001&quot;)\n\nallTables &lt;- dbGetQuery(conn, &quot;SELECT owner, table_name FROM all_tables where owner &#x3D; &#39;ZHANG2B20&#39;&quot;)</code></pre>\n<p>本地链接(我没有试过，你们可以参考如下例子)：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">drv&lt;-JDBC(&quot;oracle.jdbc.driver.OracleDriver&quot;,&quot;ojdbc6_g.jar&quot;, identifier.quote&#x3D;&quot;\\&quot;&quot;)  ##java中JDBC的套路\nconn&lt;-dbConnect(drv,&quot;jdbc:oracle:thin:@10.0.0.214:1521:zlhis&quot;,&quot;zlhis1234&quot;,&quot;his123&quot;) ##建立一个连接\nEMP&lt;-dbReadTable(conn,&#39;EMP&#39;) ##根据连接和表名获取Oracle中的表\ntable1&lt;-dbGetQuery(conn,&quot;select * from user_tables&quot;)  ##根据sql记录获取Oracle中表的数据\n————————————————\n版权声明：本文为CSDN博主「dltan」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。\n原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;tandelin&#x2F;article&#x2F;details&#x2F;99300248</code></pre>\n<p>如果数据有乱码：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">names(table1)&#x3D;iconv(names(table1),&quot;UTF-8&quot;,&quot;GBK&quot;) ##若是表中列名为中文，读取时出现乱码，可用这句来搞定乱码情况</code></pre>\n\n<p>所以按着我的例子来吧~ </p>\n<h2 id=\"数据\"><a href=\"#数据\" class=\"headerlink\" title=\"数据\"></a>数据</h2><p>接下来介绍下数据(这里可以用view函数直接看出来各个表的数据)：</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableCatalogue &lt;- dbGetQuery(conn, &quot;select * from Catalogue&quot;)\ntableClients &lt;- dbGetQuery(conn, &quot;select * from Clients&quot;)\ntableIm &lt;- dbGetQuery(conn, &quot;select * from IMMATRICULATION&quot;)\ntableMar &lt;- dbGetQuery(conn, &quot;select * from MARKETING&quot;)</code></pre>\n\n<p>因为这是一个之前做过的项目，我直接读取之前产生的数据就好了</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">load(&quot;C:&#x2F;Users&#x2F;12506&#x2F;OneDrive&#x2F;Desktop&#x2F;ESTIA3A&#x2F;R&#x2F;Projet&#x2F;.RData&quot;)</code></pre>\n\n<p>一共有四个表:</p>\n<ul>\n<li>Catalogue 记录着一共270种汽车型号，不同的颜色，品牌，马力等等。该列表的270种是该公司向外出售的车类总类</li>\n</ul>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tableCatalogue[1,])</code></pre>\n\n<pre><code>  MARQUE NOM PUISSANCE    LONGUEUR NBPLACES NBPORTES COULEUR OCCASION PRIX\n1    BMW  M5       507 tres longue        5        5    gris     TRUE    2\n  CATALOGUEID\n1         238\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableCatalogue)</code></pre>\n\n\n<pre><code>    MARQUE              NOM              PUISSANCE       LONGUEUR        \n Length:270         Length:270         Min.   : 55.0   Length:270        \n Class :character   Class :character   1st Qu.:109.0   Class :character  \n Mode  :character   Mode  :character   Median :147.0   Mode  :character  \n                                       Mean   :157.6                     \n                                       3rd Qu.:170.0                     \n                                       Max.   :507.0                     \n    NBPLACES        NBPORTES       COULEUR            OCCASION        \n Min.   :5.000   Min.   :3.000   Length:270         Length:270        \n 1st Qu.:5.000   1st Qu.:5.000   Class :character   Class :character  \n Median :5.000   Median :5.000   Mode  :character   Mode  :character  \n Mean   :5.222   Mean   :4.815                                        \n 3rd Qu.:5.000   3rd Qu.:5.000                                        \n Max.   :7.000   Max.   :5.000                                        \n      PRIX        CATALOGUEID    \n Min.   :1.000   Min.   :  1.00  \n 1st Qu.:1.000   1st Qu.: 68.25  \n Median :2.000   Median :135.50  \n Mean   :1.685   Mean   :135.50  \n 3rd Qu.:2.000   3rd Qu.:202.75  \n Max.   :3.000   Max.   :270.00  \n</code></pre>\n<ul>\n<li>Client 记录着以往的购买记录，客户的信息对应所购买的车牌号。记录着用户的年龄，性别，年税（可以推断大致固定收入），家庭状态，正在照顾的孩子个数，是否是名下第二台车以及车牌号。数据已脱敏，无法根据数据来确定用户身份</li>\n</ul>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tableClients[1,])</code></pre>\n\n<pre><code>  AGE SEXE TAUX SITUATIONFAMILIALE NBENFANTSACHARGE DEUXIEMEVOITURE\n1  55    M  561          En Couple                2            TRUE\n  IMMATRICULATION\n1      1889 KV 55\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableClients)</code></pre>\n\n\n<pre><code>      AGE           SEXE               TAUX           SITUATIONFAMILIALE\n Min.   :18.0   Length:11065       Length:11065       Length:11065      \n 1st Qu.:28.0   Class :character   Class :character   Class :character  \n Median :41.0   Mode  :character   Mode  :character   Mode  :character  \n Mean   :43.7                                                           \n 3rd Qu.:56.0                                                           \n Max.   :84.0                                                           \n NBENFANTSACHARGE DEUXIEMEVOITURE    IMMATRICULATION   \n Min.   :0.000    Length:11065       Length:11065      \n 1st Qu.:0.000    Class :character   Class :character  \n Median :1.000    Mode  :character   Mode  :character  \n Mean   :1.247                                         \n 3rd Qu.:2.000                                         \n Max.   :4.000                                         \n</code></pre>\n<ul>\n<li>Immatriculation 记录着车牌号对应的汽车信息，这些汽车的种类包含于上述270种。该数据为法国车管所提供，敏感数据已经剔除。从表中可以看出车牌号对应的车的品牌，型号，功率，长短，座位数，门数，颜色，是否是二手车以及价格。</li>\n</ul>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tableIm[1,])  </code></pre>\n\n<pre><code>  IMMATRICULATION MARQUE       NOM PUISSANCE LONGUEUR NBPLACES NBPORTES COULEUR\n1      5407 HD 88   Fiat Croma 2.2       147   longue        5        5   rouge\n  OCCASION PRIX\n1     TRUE    1\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableIm)</code></pre>\n\n\n<pre><code> IMMATRICULATION       MARQUE              NOM              PUISSANCE    \n Length:1048575     Length:1048575     Length:1048575     Min.   : 55.0  \n Class :character   Class :character   Class :character   1st Qu.: 75.0  \n Mode  :character   Mode  :character   Mode  :character   Median :150.0  \n                                                          Mean   :198.9  \n                                                          3rd Qu.:245.0  \n                                                          Max.   :507.0  \n   LONGUEUR            NBPLACES    NBPORTES       COULEUR         \n Length:1048575     Min.   :5   Min.   :3.000   Length:1048575    \n Class :character   1st Qu.:5   1st Qu.:5.000   Class :character  \n Mode  :character   Median :5   Median :5.000   Mode  :character  \n                    Mean   :5   Mean   :4.868                     \n                    3rd Qu.:5   3rd Qu.:5.000                     \n                    Max.   :5   Max.   :5.000                     \n   OCCASION              PRIX      \n Length:1048575     Min.   :1.000  \n Class :character   1st Qu.:1.000  \n Mode  :character   Median :2.000  \n                    Mean   :1.796  \n                    3rd Qu.:2.000  \n                    Max.   :3.000  \n</code></pre>\n<ul>\n<li>Marketing 9个新客户，为他们提供一个车型的推荐，最终交付成果是给他们</li>\n</ul>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tableMar[1,])  </code></pre>\n\n<pre><code>  AGE SEXE TAUX SITUATIONFAMILIALE NBENFANTSACHARGE DEUXIEMEVOITURE\n1  21    F 1396        celibataire                0           FALSE\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableMar)</code></pre>\n\n\n<pre><code>      AGE            SEXE                TAUX        SITUATIONFAMILIALE\n Min.   :21.00   Length:9           Min.   : 559.0   Length:9          \n 1st Qu.:35.00   Class :character   1st Qu.: 588.0   Class :character  \n Median :58.00   Mode  :character   Median : 748.0   Mode  :character  \n Mean   :51.56                      Mean   : 859.7                     \n 3rd Qu.:59.00                      3rd Qu.:1112.0                     \n Max.   :79.00                      Max.   :1396.0                     \n NBENFANTSACHARGE DEUXIEMEVOITURE   \n Min.   :0.0000   Length:9          \n 1st Qu.:0.0000   Class :character  \n Median :0.0000   Mode  :character  \n Mean   :0.4444                     \n 3rd Qu.:0.0000                     \n Max.   :2.0000                     \n</code></pre>\n<p>将Immatriculation表与Catalogue表合并，可以标记每条数据对应的种类序号</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableIm_f &lt;- merge(tableIm, tableCatalogue, by &#x3D; c(&quot;MARQUE&quot;,&quot;NOM&quot;, &quot;PUISSANCE&quot;, &quot;LONGUEUR&quot;, &quot;NBPORTES&quot;,&quot;COULEUR&quot;,&quot;OCCASION&quot;,&quot;PRIX&quot;))\n\nsummary(tableIm_f)</code></pre>\n\n\n<pre><code>    MARQUE              NOM              PUISSANCE       LONGUEUR        \n Length:1048575     Length:1048575     Min.   : 55.0   Length:1048575    \n Class :character   Class :character   1st Qu.: 75.0   Class :character  \n Mode  :character   Mode  :character   Median :150.0   Mode  :character  \n                                       Mean   :198.9                     \n                                       3rd Qu.:245.0                     \n                                       Max.   :507.0                     \n    NBPORTES       COULEUR            OCCASION              PRIX      \n Min.   :3.000   Length:1048575     Length:1048575     Min.   :1.000  \n 1st Qu.:5.000   Class :character   Class :character   1st Qu.:1.000  \n Median :5.000   Mode  :character   Mode  :character   Median :2.000  \n Mean   :4.868                                         Mean   :1.796  \n 3rd Qu.:5.000                                         3rd Qu.:2.000  \n Max.   :5.000                                         Max.   :3.000  \n IMMATRICULATION      NBPLACES.x   NBPLACES.y  CATALOGUEID   \n Length:1048575     Min.   :5    Min.   :5    Min.   :  1.0  \n Class :character   1st Qu.:5    1st Qu.:5    1st Qu.: 78.0  \n Mode  :character   Median :5    Median :5    Median :165.0  \n                    Mean   :5    Mean   :5    Mean   :154.7  \n                    3rd Qu.:5    3rd Qu.:5    3rd Qu.:234.0  \n                    Max.   :5    Max.   :5    Max.   :270.0  \n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tableIm_f[1,])  </code></pre>\n\n<pre><code>  MARQUE    NOM PUISSANCE LONGUEUR NBPORTES COULEUR OCCASION PRIX\n1   Audi A2 1.4        75   courte        5   blanc    FALSE    1\n  IMMATRICULATION NBPLACES.x NBPLACES.y CATALOGUEID\n1      5874 MF 21          5          5         270\n</code></pre>\n<h2 id=\"确定标签\"><a href=\"#确定标签\" class=\"headerlink\" title=\"确定标签\"></a>确定标签</h2><p>这一步还是非常重要的，也是熟悉业务的基础。<br>从标签的角度来讲，我们需要知道哪些参数是未来想要被预测的，并且知道他们值的类型，是离散还是连续，是二分类还是多分类；<br>从特征的角度来讲，我们需要去掉对标签毫无影响的特征。<br>由于算法已经封装完整，默认建模后所有输入特征均为变量，所以我们在运行前需要把不相关列给过滤掉。<br>这个项目变量复杂，只列举其中几个需要预测的标签。</p>\n<ul>\n<li>Prix价格，我们将原本离散的价格分成三段，Economique，Moyen,Luxe，法语对应的意思为，经济，中等，奢侈</li>\n<li>Occasion二手，为二分类变量是或否</li>\n<li>Longueur长度，分成四段，coute, longue, moyenne, tres longue,法语对应的意思为，短，长，中等，特长</li>\n<li>Nbportes车门数量，经过后期可视化观察，一共有两种，3车门和5车门（包括行李箱门）</li>\n<li>Couleur颜色，一共有五种，blanc,bleu,gris,noir,rouge。法语对应的意思为白色，蓝色，灰色，黑色，红色。</li>\n</ul>\n<h2 id=\"Prix价格\"><a href=\"#Prix价格\" class=\"headerlink\" title=\"Prix价格\"></a>Prix价格</h2><h3 id=\"数据准备\"><a href=\"#数据准备\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h3><p>取Immatriculation第八九列，可以得到车牌号对应车的价格</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableImPrix &lt;- tableIm_f[c(8, 9)]\nprint(tableImPrix[1,]) </code></pre>\n\n<pre><code>  PRIX IMMATRICULATION\n1    1      5874 MF 21\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">boxplot(tablePrixFinal$PRIX, data&#x3D;tablePrixFinal, main&#x3D;&quot;Distrubution de Prix&quot;, ylab&#x3D;&quot;Prix&quot;)\n## 通过这个语句刚开始可以看出价格是离散的，但是我们希望他是三分类标签，因此我们需要对其进行重定义</code></pre>\n\n\n<pre><code>Error in x[floor(d)] + x[ceiling(d)]: 二进列运算符中有非数值参数\nTraceback:\n\n\n1. boxplot(tablePrixFinal$PRIX, data = tablePrixFinal, main = &quot;Distrubution de Prix&quot;, \n .     ylab = &quot;Prix&quot;)\n\n2. boxplot.default(tablePrixFinal$PRIX, data = tablePrixFinal, main = &quot;Distrubution de Prix&quot;, \n .     ylab = &quot;Prix&quot;)\n\n3. boxplot.stats(unclass(groups[[i]]), range)\n\n4. stats::fivenum(x, na.rm = TRUE)\n</code></pre>\n<p>赋值，将每段赋予所对应的含义</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">table(tableImPrix$PRIX)\n##J&#39;ai pas touve une methode qui nous permets de realiser la meme fonction de Update\ntableImPrix &lt;- within(tableImPrix,&#123;\n  PRIX[PRIX &#x3D;&#x3D; 3] &lt;- &quot;Luxe&quot;\n  PRIX[PRIX &#x3D;&#x3D; 2] &lt;- &quot;Moyen&quot;\n  PRIX[PRIX &#x3D;&#x3D; 1] &lt;- &quot;Economique&quot;\n&#125;)</code></pre>\n\n\n\n<pre><code>     1      2      3 \n355549 551284 141742 \n</code></pre>\n<p>将所得结果和Clients表合并，可以得到每个用户的信息和所购买车辆的价格的对应关系</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tablePrixFinal &lt;- merge(tableClients, tableImPrix, by &#x3D; &quot;IMMATRICULATION&quot;, incomparables &#x3D; NA)\n#requête pour la distribution des données: Prix\nsummary(tablePrixFinal$PRIX)</code></pre>\n\n\n<pre><code>   Length     Class      Mode \n    11082 character character \n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(tablePrixFinal[1,]) </code></pre>\n\n<pre><code>  IMMATRICULATION AGE SEXE TAUX SITUATIONFAMILIALE NBENFANTSACHARGE\n1         1 EF 20  18    F  594        celibataire                0\n  DEUXIEMEVOITURE  PRIX\n1           FALSE Moyen\n</code></pre>\n<h3 id=\"可视化数据\"><a href=\"#可视化数据\" class=\"headerlink\" title=\"可视化数据\"></a>可视化数据</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## attach()在R语言中表示添加路径存储的索引，相当于绑定一个数据框，如果未绑定路径索引，可能导致数据读取错误。\n## 简单来说固定之后就可以直接通过 数据框中的变量名 来调用数据了\nattach(tablePrixFinal)\nqplot(AGE, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)\nqplot(SEXE, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)\nqplot(TAUX, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tablePrixFinal &lt;- subset(tablePrixFinal, select&#x3D;-IMMATRICULATION)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 年龄，性别，税缴和购买车辆价格的关系\nqplot(AGE, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)\nqplot(SEXE, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)\nqplot(TAUX, data&#x3D;tablePrixFinal, fill&#x3D;PRIX)</code></pre>\n\n<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_34_1.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_34_2.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_34_3.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 年龄，税缴和购买车辆价格的关系\nqplot(AGE, TAUX, data&#x3D;tablePrixFinal,color&#x3D;PRIX)</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_35_0.png\" alt=\"png\"></p>\n<h3 id=\"划分训练集和验证集\"><a href=\"#划分训练集和验证集\" class=\"headerlink\" title=\"划分训练集和验证集\"></a>划分训练集和验证集</h3><p>通常情况下需要按照数据量的大小选择多次cross-validation（交叉验证）<br>本项目测试集为每个单表104万余条数据，选择了五次的交叉验证<br>接下来就以一次交叉验证为例子</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">Prix_EA &lt;- tablePrixFinal[1:7388,]\nPrix_ET &lt;- tablePrixFinal[7389:11082,]</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 建模前观察变量的类型，如果有不对的，比如数值为string格式，需要提前变回来\nstr(Prix_EA)</code></pre>\n\n<pre><code>&#39;data.frame&#39;:    7388 obs. of  7 variables:\n $ AGE               : num  18 33 26 76 20 27 45 28 28 38 ...\n $ SEXE              : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ...\n $ TAUX              : chr  &quot;594&quot; &quot;1380&quot; &quot;597&quot; &quot;587&quot; ...\n $ SITUATIONFAMILIALE: chr  &quot;celibataire&quot; &quot;En Couple&quot; &quot;En Couple&quot; &quot;En Couple&quot; ...\n $ NBENFANTSACHARGE  : num  0 4 0 1 0 0 0 2 2 0 ...\n $ DEUXIEMEVOITURE   : chr  &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; ...\n $ PRIX              : chr  &quot;Moyen&quot; &quot;Luxe&quot; &quot;Moyen&quot; &quot;Luxe&quot; ...\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">Prix_EA$TAUX &lt;- as.integer(Prix_EA$TAUX)\nPrix_ET$TAUX &lt;- as.integer(Prix_ET$TAUX)</code></pre>\n\n<h3 id=\"比较三种决策树的性能\"><a href=\"#比较三种决策树的性能\" class=\"headerlink\" title=\"比较三种决策树的性能\"></a>比较三种决策树的性能</h3><ul>\n<li>rpart</li>\n<li>c5.0</li>\n<li>CART分类与回归树</li>\n</ul>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">Prixtree1 &lt;- rpart(PRIX~., Prix_EA)\nprp(Prixtree1, type&#x3D;4, extra&#x3D;1, box.col&#x3D;c(&quot;tomato&quot;, &quot;skyblue&quot;)[Prixtree1$frame$yval])</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_41_0.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">Prix_EA$PRIX &lt;- as.factor(Prix_EA$PRIX)\nPrixtree2 &lt;- C5.0(PRIX~., Prix_EA)\nplot(Prixtree2, type&#x3D;&quot;simple&quot;)</code></pre>\n\n<pre><code>Warning message in partysplit(varid = as.integer(i), breaks = as.numeric(j[1]), :\n&quot;强制改变过程中产生了NA&quot;\nWarning message in partysplit(varid = as.integer(i), breaks = as.numeric(j[1]), :\n&quot;强制改变过程中产生了NA&quot;\nWarning message in partysplit(varid = as.integer(i), breaks = as.numeric(j[1]), :\n&quot;强制改变过程中产生了NA&quot;\nWarning message in .bincode(as.numeric(x), breaks = unique(c(-Inf, breaks_split(split), :\n&quot;强制改变过程中产生了NA&quot;\nWarning message in .bincode(as.numeric(x), breaks = unique(c(-Inf, breaks_split(split), :\n&quot;强制改变过程中产生了NA&quot;\nWarning message in .bincode(as.numeric(x), breaks = unique(c(-Inf, breaks_split(split), :\n&quot;强制改变过程中产生了NA&quot;\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_42_1.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">Prixtree3 &lt;- tree(PRIX~., data&#x3D;Prix_EA)\nplot(Prixtree3)\ntext(Prixtree3, pretty&#x3D;0)</code></pre>\n\n<pre><code>Warning message in tree(PRIX ~ ., data = Prix_EA):\n&quot;强制改变过程中产生了NA&quot;\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_43_1.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 应用验证集\npredPrix.tree1 &lt;- predict(Prixtree1, Prix_ET, type&#x3D;&quot;class&quot;)\npredPrix.tree2 &lt;- predict(Prixtree2, Prix_ET, type&#x3D;&quot;class&quot;)\npredPrix.tree3 &lt;- predict(Prixtree3, Prix_ET, type&#x3D;&quot;class&quot;)\n# 输出混淆矩阵\ntable(Prix_ET$PRIX, predPrix.tree1)\ntable(Prix_ET$PRIX, predPrix.tree2)\ntable(Prix_ET$PRIX, predPrix.tree3)</code></pre>\n\n<pre><code>Warning message in pred1.tree(object, tree.matrix(newdata)):\n&quot;强制改变过程中产生了NA&quot;\n\n\n\n            predPrix.tree1\n             Economique Luxe Moyen\n  Economique       1187    1     1\n  Luxe                1  541   346\n  Moyen             250   32  1335\n\n\n\n            predPrix.tree2\n             Economique Luxe Moyen\n  Economique       1074    1   114\n  Luxe                1  537   350\n  Moyen             115    1  1501\n\n\n\n            predPrix.tree3\n             Economique Luxe Moyen\n  Economique        739    1   449\n  Luxe               94  551   243\n  Moyen             197   32  1388\n</code></pre>\n<h3 id=\"随机森林\"><a href=\"#随机森林\" class=\"headerlink\" title=\"随机森林\"></a>随机森林</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 学习\nrfPrix &lt;- randomForest(PRIX~., Prix_EA)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 应用验证集\nrf_classPrix &lt;- predict(rfPrix,Prix_ET, type&#x3D;&quot;response&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 混淆矩阵\ntable(Prix_ET$PRIX, rf_classPrix)</code></pre>\n\n\n<pre><code>            rf_classPrix\n             Economique Luxe Moyen\n  Economique       1184    1     4\n  Luxe                1  544   343\n  Moyen             247   14  1356\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 将结果以概率的形式展现出来\nrf_probPrix &lt;- predict(rfPrix, Prix_ET, type&#x3D;&quot;prob&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 输出结果为对应的每条数据，三种结果的百分比可能性\nprint(rf_probPrix[1,])  </code></pre>\n\n<pre><code>Economique       Luxe      Moyen \n     0.000      0.218      0.782 \n</code></pre>\n<h3 id=\"支持向量机\"><a href=\"#支持向量机\" class=\"headerlink\" title=\"支持向量机\"></a>支持向量机</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 学习\nsvmPrix &lt;- svm(PRIX~., Prix_EA, probability&#x3D;TRUE)\n# 应用验证集\nsvm_classPrix &lt;- predict(svmPrix, Prix_ET, type&#x3D;&quot;response&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 混淆矩阵\ntable(Prix_ET$PRIX, svm_classPrix)</code></pre>\n\n\n<pre><code>            svm_classPrix\n             Economique Luxe Moyen\n  Economique       1187    1     1\n  Luxe                1  516   371\n  Moyen             251    6  1360\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 将结果以概率的形式展现出来\nsvm_prob &lt;- predict(svmPrix, Prix_ET, probability&#x3D;TRUE)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 由于支持向量机必须是二分类标签，所以需要做如下操作\nsvm_prob &lt;- attr(svm_prob, &quot;probabilities&quot;)\n# 转成 data frame \nsvm_prob &lt;- as.data.frame(svm_prob)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 输出结果为对应的每条数据，三种结果的百分比可能性\nprint(svm_prob[1,])  </code></pre>\n\n<pre><code>         Moyen      Luxe   Economique\n7389 0.8062865 0.1936253 8.821378e-05\n</code></pre>\n<h3 id=\"朴素贝叶斯\"><a href=\"#朴素贝叶斯\" class=\"headerlink\" title=\"朴素贝叶斯\"></a>朴素贝叶斯</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 学习\nnbPrix &lt;- naive_bayes(PRIX~., Prix_EA)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 应用验证集\nnbPrix_class &lt;- predict(nbPrix, Prix_ET, type&#x3D;&quot;class&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 混淆矩阵\ntable( Prix_ET$PRIX, nbPrix_class)</code></pre>\n\n\n<pre><code>            nbPrix_class\n             Economique Luxe Moyen\n  Economique       1060  103    26\n  Luxe               37  584   267\n  Moyen             301  269  1047\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 输出结果为对应的每条数据，三种结果的百分比可能性\nnbPrix_prob &lt;- predict(nbPrix, Prix_ET, type&#x3D;&quot;prob&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(nbPrix_prob[1,])  </code></pre>\n\n<pre><code>Economique       Luxe      Moyen \n 0.1389895  0.2819994  0.5790110 \n</code></pre>\n<h3 id=\"神经网络\"><a href=\"#神经网络\" class=\"headerlink\" title=\"神经网络\"></a>神经网络</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 学习\nnnPrix &lt;- nnet(PRIX~., Prix_EA, size&#x3D;12)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 应用验证集\nnnPrix_class &lt;- predict(nnPrix, Prix_ET, type&#x3D;&quot;class&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 混淆矩阵\ntable(Prix_ET$PRIX, nnPrix_class)</code></pre>\n\n\n<pre><code>            nnPrix_class\n             Moyen\n  Economique  1189\n  Luxe         888\n  Moyen       1617\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 输出结果为对应的每条数据，三种结果的百分比可能性\nnnPrix_prob &lt;- predict(nnPrix, Prix_ET, type&#x3D;&quot;raw&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(nnPrix_prob[1,])  </code></pre>\n\n<pre><code>Economique       Luxe      Moyen \n 0.3256632  0.2581213  0.4162155 \n</code></pre>\n<h3 id=\"K近邻\"><a href=\"#K近邻\" class=\"headerlink\" title=\"K近邻\"></a>K近邻</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 学习，直接应用于验证集\nknnPrix &lt;- kknn(PRIX~., Prix_EA, Prix_ET)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 混淆矩阵\ntable(Prix_ET$PRIX, knnPrix$fitted.values)</code></pre>\n\n\n\n<pre><code>             Economique Luxe Moyen\n  Economique       1105    1    83\n  Luxe                3  631   254\n  Moyen             142  203  1272\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 输出结果为对应的每条数据，三种结果的百分比可能性\nknnPrix_prob &lt;- as.data.frame(knnPrix$prob)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">print(knnPrix_prob[1,])  </code></pre>\n\n<pre><code>  Economique      Luxe     Moyen\n1          0 0.5883995 0.4116005\n</code></pre>\n<h3 id=\"将表现最好的模型应用于将要预测的数据集\"><a href=\"#将表现最好的模型应用于将要预测的数据集\" class=\"headerlink\" title=\"将表现最好的模型应用于将要预测的数据集\"></a>将表现最好的模型应用于将要预测的数据集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 可视化将要验证的数据集\nView(tableMar) \n#&#x3D;&#x3D;&#x3D; C5.0 概率&#x3D;&#x3D;&#x3D;#\nclass.treeC50 &lt;- predict(Prixtree2, tableMar, probability&#x3D;TRUE)\nprob.treeC50 &lt;- attr(class.treeC50, &quot;probabilities&quot;)\nprob.treeC50 &lt;- as.data.frame(prob.treeC50)\nresultatPrix &lt;- data.frame(tableMar$ID, class.treeC50, prob.treeC50)\n\n\n#&#x3D;&#x3D;&#x3D; C5.0分类 &#x3D;&#x3D;&#x3D;#\nclass.treeC50 &lt;- predict(Prixtree2, tableMar, type&#x3D;&quot;class&quot;)\nprob.treeC50 &lt;- predict(Prixtree2, tableMar, type&#x3D;&quot;prob&quot;)\nresultatPrix &lt;- data.frame(tableMar, class.treeC50, prob.treeC50)\nresultatPrix &lt;- data.frame(tableMar, class.treeC50)\n\n\n# 重命名预测列名称\nnames(resultatPrix)[7] &lt;- &quot;PRIX&quot;\n\n# 将结果保存到csv文件\nwrite.table(resultat1, file&#x3D;&#39;predictions.csv&#39;, sep&#x3D;&quot;\\t&quot;, dec&#x3D;&quot;.&quot;, row.names &#x3D; F)</code></pre>\n\n<h2 id=\"Occasion二手\"><a href=\"#Occasion二手\" class=\"headerlink\" title=\"Occasion二手\"></a>Occasion二手</h2><h3 id=\"数据准备-1\"><a href=\"#数据准备-1\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h3><p>取Immatriculation第七九列，可以得到车牌号对应车的价格</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableImOCCA &lt;- tableIm_f[c(7, 9)]\nprint(tableImOCCA[1,]) </code></pre>\n\n<pre><code>  OCCASION IMMATRICULATION\n1    FALSE      5874 MF 21\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 将所得结果和Clients表合并，可以得到每个用户的信息和所购买车辆的二手情况的对应关系\ntableOCCAFinal &lt;- merge(tableClients, tableImOCCA, by &#x3D; &quot;IMMATRICULATION&quot;, incomparables &#x3D; NA)\n\n## 建模前观察变量的类型，如果有不对的，比如数值为string格式，需要提前变回来\nstr(tableOCCAFinal)\ntableOCCAFinal$TAUX &lt;- as.integer(tableOCCAFinal$TAUX)</code></pre>\n\n<pre><code>&#39;data.frame&#39;:    11082 obs. of  8 variables:\n $ IMMATRICULATION   : chr  &quot;1 EF 20&quot; &quot;10 ZM 12&quot; &quot;100 XL 72&quot; &quot;100 YT 70&quot; ...\n $ AGE               : num  18 33 26 76 20 27 45 28 28 38 ...\n $ SEXE              : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ...\n $ TAUX              : chr  &quot;594&quot; &quot;1380&quot; &quot;597&quot; &quot;587&quot; ...\n $ SITUATIONFAMILIALE: chr  &quot;celibataire&quot; &quot;En Couple&quot; &quot;En Couple&quot; &quot;En Couple&quot; ...\n $ NBENFANTSACHARGE  : num  0 4 0 1 0 0 0 2 2 0 ...\n $ DEUXIEMEVOITURE   : chr  &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; ...\n $ OCCASION          : chr  &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;TRUE&quot; ...\n</code></pre>\n<h3 id=\"可视化数据-1\"><a href=\"#可视化数据-1\" class=\"headerlink\" title=\"可视化数据\"></a>可视化数据</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">library(ggplot2)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">qplot(OCCASION, data&#x3D;tableOCCAFinal)\ntable(tableOCCAFinal$DEUXIEMEVOITURE,tableOCCAFinal$OCCASION)\nqplot(DEUXIEMEVOITURE, data&#x3D;tableOCCAFinal, color&#x3D;OCCASION)\nqplot(TAUX, data&#x3D;tableOCCAFinal, fill&#x3D;OCCASION, bins &#x3D;5)\nboxplot(AGE~OCCASION, data&#x3D;tableOCCAFinal, col&#x3D;c(&quot;red&quot;,&quot;blue&quot;))\nqplot(SEXE, data&#x3D;tableOCCAFinal, color&#x3D;OCCASION)</code></pre>\n\n\n\n<pre><code>        FALSE TRUE\n  FALSE  8408 1276\n  TRUE   1234  164\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_82_1.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_82_2.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_82_3.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_82_4.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_82_5.png\" alt=\"png\"></p>\n<h3 id=\"划分训练集和验证集-1\"><a href=\"#划分训练集和验证集-1\" class=\"headerlink\" title=\"划分训练集和验证集\"></a>划分训练集和验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableOCCAFinal &lt;- subset(tableOCCAFinal, select&#x3D;-IMMATRICULATION)\nOCCA_EA &lt;- tableOCCAFinal[1:7388,]\nOCCA_ET &lt;- tableOCCAFinal[7389:11082,]</code></pre>\n\n<h3 id=\"应用三种决策树和五种机器学习算法\"><a href=\"#应用三种决策树和五种机器学习算法\" class=\"headerlink\" title=\"应用三种决策树和五种机器学习算法\"></a>应用三种决策树和五种机器学习算法</h3><p>和之前价格的例子一样，我们对该训练集应用三种决策树和五种机器学习算法</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 3种决策树\nOCCAtree1 &lt;- rpart(OCCASION~., OCCA_EA)\nOCCA_EA$OCCASION &lt;- as.factor(OCCA_EA$OCCASION)\nOCCAtree2 &lt;- C5.0(OCCASION~., OCCA_EA)\nOCCAtree3 &lt;- tree(OCCASION~., data&#x3D;OCCA_EA)\n# 随机森林\nrfOCCA &lt;- randomForest(OCCASION~., OCCA_EA)\n# 支持向量机\nsvmOCCA &lt;- svm(OCCASION~., OCCA_EA, probability&#x3D;TRUE)\n# 朴素贝叶斯\nnbOCCA &lt;- naive_bayes(OCCASION~., OCCA_EA)\n# 神经网络\nnnOCCA &lt;- nnet(OCCASION~., OCCA_EA, size&#x3D;12)\n# K近邻\nknnOCCA &lt;- kknn(OCCASION~., OCCA_EA, OCCA_ET)</code></pre>\n\n<h3 id=\"将学习好的模型应用于验证集\"><a href=\"#将学习好的模型应用于验证集\" class=\"headerlink\" title=\"将学习好的模型应用于验证集\"></a>将学习好的模型应用于验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 应用于验证集，k近邻算法在训练时已经得到了结果\npredOCCA.tree1 &lt;- predict(OCCAtree1, OCCA_ET, type&#x3D;&quot;class&quot;)\npredOCCA.tree2 &lt;- predict(OCCAtree2, OCCA_ET, type&#x3D;&quot;class&quot;)\npredOCCA.tree3 &lt;- predict(OCCAtree3, OCCA_ET, type&#x3D;&quot;class&quot;)\nresult.rfOCCA &lt;- predict(rfOCCA,OCCA_ET, type&#x3D;&quot;response&quot;)\nresult.svmOCCA &lt;- predict(svmOCCA,OCCA_ET, type&#x3D;&quot;response&quot;)\nresult.treeNaiveOCCA &lt;- predict(nbOCCA,OCCA_ET, type&#x3D;&quot;class&quot;)\nresult.treeNnetOCCA &lt;- predict(nnOCCA, OCCA_ET,type&#x3D;&quot;class&quot;)</code></pre>\n\n<h3 id=\"混淆矩阵对比\"><a href=\"#混淆矩阵对比\" class=\"headerlink\" title=\"混淆矩阵对比\"></a>混淆矩阵对比</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">table(OCCA_ET$OCCASION, predOCCA.tree1)\ntable(OCCA_ET$OCCASION, predOCCA.tree2)\ntable(OCCA_ET$OCCASION, predOCCA.tree3)\ntable(OCCA_ET$OCCASION, result.rfOCCA)\ntable(OCCA_ET$OCCASION, result.svmOCCA)\ntable(OCCA_ET$OCCASION, result.treeNaiveOCCA)\ntable(OCCA_ET$OCCASION, result.treeNnetOCCA)\ntable(OCCA_ET$OCCASION, knnOCCA$fitted.values)</code></pre>\n\n\n<pre><code>       predOCCA.tree1\n        FALSE TRUE\n  FALSE  3189   37\n  TRUE    290  178\n\n\n\n       predOCCA.tree2\n        FALSE TRUE\n  FALSE  3189   37\n  TRUE    290  178\n\n\n\n       predOCCA.tree3\n        FALSE TRUE\n  FALSE  3189   37\n  TRUE    290  178\n\n\n\n       result.rfOCCA\n        FALSE TRUE\n  FALSE  3181   45\n  TRUE    290  178\n\n\n\n       result.svmOCCA\n        FALSE TRUE\n  FALSE  3186   40\n  TRUE    307  161\n\n\n\n       result.treeNaiveOCCA\n        FALSE TRUE\n  FALSE  2518  708\n  TRUE      2  466\n\n\n\n       result.treeNnetOCCA\n        FALSE\n  FALSE  3226\n  TRUE    468\n\n\n\n       \n        FALSE TRUE\n  FALSE  3020  206\n  TRUE    228  240\n</code></pre>\n<h3 id=\"ROC曲线和AUC对比\"><a href=\"#ROC曲线和AUC对比\" class=\"headerlink\" title=\"ROC曲线和AUC对比\"></a>ROC曲线和AUC对比</h3><p>在画出ROC曲线前，我们需要把所有的模型转成概率形式</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># Test du classifieur : probabilites pour chaque prediction\np.treeRpartOCCA &lt;- predict(OCCAtree1, OCCA_ET, type&#x3D;&quot;prob&quot;)\nroc.predOCCA1 &lt;- prediction(p.treeRpartOCCA[,2], OCCA_ET$OCCASION)\n\np.treec50OCCA &lt;- predict(OCCAtree2, OCCA_ET, type&#x3D;&quot;prob&quot;)\nroc.predOCCA2 &lt;- prediction(p.treec50OCCA[,2], OCCA_ET$OCCASION)\n\np.treeTreeOCCA &lt;- predict(OCCAtree3, OCCA_ET, type&#x3D;&quot;vector&quot;)\nroc.predOCCA3 &lt;- prediction(p.treeTreeOCCA[,2], OCCA_ET$OCCASION)\n\nrf_probOCCA &lt;- predict(rfOCCA, OCCA_ET, type&#x3D;&quot;prob&quot;)\nroc.predOCCA4 &lt;- prediction(rf_probOCCA[,2], OCCA_ET$OCCASION)\n\nsvm_probOCCA &lt;- predict(svmOCCA, OCCA_ET, probability&#x3D;TRUE)\nsvm_probOCCA &lt;- attr(svm_probOCCA, &quot;probabilities&quot;)\nsvm_probOCCA &lt;- as.data.frame(svm_probOCCA)\nroc.predOCCA5 &lt;- prediction(svm_probOCCA[,2], OCCA_ET$OCCASION)\n\n\nnb_probOCCA &lt;- predict(nbOCCA, OCCA_ET, type&#x3D;&quot;prob&quot;)\nroc.predOCCA6 &lt;- prediction(nb_probOCCA[,2], OCCA_ET$OCCASION)\n\n\nnn_probOCCA &lt;- predict(nnOCCA, OCCA_ET, type&#x3D;&quot;raw&quot;)\nroc.predOCCA7 &lt;- prediction(nn_probOCCA[,1], OCCA_ET$OCCASION)\n\n\nknn_probOCCA &lt;- as.data.frame(knnOCCA$prob)\nroc.predOCCA8 &lt;- prediction(knn_probOCCA[,2], OCCA_ET$OCCASION)</code></pre>\n\n<pre><code>Warning message in pred1.tree(object, tree.matrix(newdata)):\n&quot;强制改变过程中产生了NA&quot;\nWarning message:\n&quot;predict.naive_bayes(): more features in the newdata are provided as there are probability tables in the object. Calculation is performed based on features to be found in the tables.&quot;\n</code></pre>\n<p>然后计算出AUC指数</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">auc.treeOCCA1 &lt;- performance(roc.predOCCA1, &quot;auc&quot;)\nauc.treeOCCA2 &lt;- performance(roc.predOCCA2, &quot;auc&quot;)\nauc.treeOCCA3 &lt;- performance(roc.predOCCA3, &quot;auc&quot;)\nauc.treeOCCA4 &lt;- performance(roc.predOCCA4, &quot;auc&quot;)\nauc.treeOCCA5 &lt;- performance(roc.predOCCA5, &quot;auc&quot;)\nauc.treeOCCA6 &lt;- performance(roc.predOCCA6, &quot;auc&quot;)\nauc.treeOCCA7 &lt;- performance(roc.predOCCA7, &quot;auc&quot;)\nauc.treeOCCA8 &lt;- performance(roc.predOCCA8, &quot;auc&quot;)\n\nattr(auc.treeOCCA1, &quot;y.values&quot;)\nattr(auc.treeOCCA2, &quot;y.values&quot;)\nattr(auc.treeOCCA3, &quot;y.values&quot;)\nattr(auc.treeOCCA4, &quot;y.values&quot;)\nattr(auc.treeOCCA5, &quot;y.values&quot;)\nattr(auc.treeOCCA6, &quot;y.values&quot;)\nattr(auc.treeOCCA7, &quot;y.values&quot;)\nattr(auc.treeOCCA8, &quot;y.values&quot;)</code></pre>\n\n\n<ol>\n    <li>0.924155896800038</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.924155896800038</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.924155896800038</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.9247705607749</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.920831213802376</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.924622524785262</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.5</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.903374558210268</li>\n</ol>\n\n\n\n<h3 id=\"画出ROC曲线，根据AUC指数选择该标签最适合的算法\"><a href=\"#画出ROC曲线，根据AUC指数选择该标签最适合的算法\" class=\"headerlink\" title=\"画出ROC曲线，根据AUC指数选择该标签最适合的算法\"></a>画出ROC曲线，根据AUC指数选择该标签最适合的算法</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">roc.perfOCCA1 &lt;- performance(roc.predOCCA1,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA2 &lt;- performance(roc.predOCCA2,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA3 &lt;- performance(roc.predOCCA3,&quot;tpr&quot;,&quot;fpr&quot;)\nroc_perfOCCA4 &lt;- performance(roc.predOCCA4,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA5 &lt;- performance(roc.predOCCA5,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA6 &lt;- performance(roc.predOCCA6,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA7 &lt;- performance(roc.predOCCA7,&quot;tpr&quot;,&quot;fpr&quot;)\nroc.perfOCCA8 &lt;- performance(roc.predOCCA8,&quot;tpr&quot;,&quot;fpr&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># Courbe ROC\nplot(roc.perfOCCA1, col &#x3D; &quot;green&quot;)\nplot(roc.perfOCCA2, col &#x3D; &quot;red&quot;, add&#x3D;TRUE)\nplot(roc.perfOCCA3, col &#x3D; &quot;blue&quot;, add&#x3D;TRUE)\nplot(roc_perfOCCA4, add &#x3D; TRUE, col &#x3D; &quot;magenta&quot;)\nplot(roc.perfOCCA5, add &#x3D; TRUE, col &#x3D; &quot;darkorange&quot;)\nplot(roc.perfOCCA6, add &#x3D; TRUE, col &#x3D; &quot;darkgreen&quot;)\nplot(roc.perfOCCA7, add &#x3D; TRUE, col &#x3D; &quot;black&quot;)\nplot(roc.perfOCCA8, add &#x3D; TRUE, col &#x3D; &quot;darkmagenta&quot;)</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_98_0.png\" alt=\"png\"></p>\n<h3 id=\"将表现最好的模型应用于将要预测的数据集-1\"><a href=\"#将表现最好的模型应用于将要预测的数据集-1\" class=\"headerlink\" title=\"将表现最好的模型应用于将要预测的数据集\"></a>将表现最好的模型应用于将要预测的数据集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">#&#x3D;&#x3D;&#x3D; RANDOM FORESTS &#x3D;&#x3D;&#x3D;#\nclass.treerfOCCA &lt;- predict(rfOCCA, tableMar, probability&#x3D;TRUE)\nresultatOCCA &lt;- data.frame(tableMar, class.treerfOCCA)\n\n# Renommage de la colonne des classes predites\nnames(resultatOCCA)[7] &lt;- &quot;OCCASION&quot;</code></pre>\n\n<h2 id=\"NBPortes车门数量\"><a href=\"#NBPortes车门数量\" class=\"headerlink\" title=\"NBPortes车门数量\"></a>NBPortes车门数量</h2><h3 id=\"数据准备-2\"><a href=\"#数据准备-2\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h3><p>取Immatriculation第五九列，可以得到车牌号对应车的车门数</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableImNP&lt;- tableIm_f[c(5,9)]\nprint(tableImNP[1,]) </code></pre>\n\n<pre><code>  NBPORTES IMMATRICULATION\n1        5      5874 MF 21\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 将所得结果和Clients表合并，可以得到每个用户的信息和所购买车辆的车门数量的对应关系\ntableFinal_np&lt;- merge(tableClients, tableImNP,by&#x3D; &quot;IMMATRICULATION&quot;, incomparables &#x3D;NA)\nprint(tableFinal_np[1,]) </code></pre>\n\n<pre><code>  IMMATRICULATION AGE SEXE TAUX SITUATIONFAMILIALE NBENFANTSACHARGE\n1         1 EF 20  18    F  594        celibataire                0\n  DEUXIEMEVOITURE NBPORTES\n1           FALSE        5\n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableFinal_np$NBPORTES)</code></pre>\n\n\n<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  3.000   5.000   5.000   4.951   5.000   5.000 \n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 建模前观察变量的类型，如果有不对的，比如数值为string格式，需要提前变回来\nNBPORTES_EA$TAUX &lt;- as.integer(NBPORTES_EA$TAUX)\nNBPORTES_ET$TAUX &lt;- as.integer(NBPORTES_ET$TAUX)</code></pre>\n\n<h3 id=\"可视化数据-2\"><a href=\"#可视化数据-2\" class=\"headerlink\" title=\"可视化数据\"></a>可视化数据</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">attach(tableFinal_np)\ntableFinal_np&lt;-subset(tableFinal_np, select &#x3D; -IMMATRICULATION)\nqplot(NBPORTES, data&#x3D;tableFinal_np)\nqplot(SEXE,data&#x3D;tableFinal_np, fill&#x3D;NBPORTES)\nqplot(NBENFANTSACHARGE,data&#x3D;tableFinal_np, fill&#x3D;NBPORTES)\nqplot(TAUX,data&#x3D;tableFinal_np, fill&#x3D;NBPORTES, bins&#x3D;5)\nqplot(DEUXIEMEVOITURE, data&#x3D;tableFinal_np, fill&#x3D;NBPORTES)\nqplot(SITUATIONFAMILIALE, data&#x3D;tableFinal_np, fill&#x3D;NBPORTES)\nboxplot(AGE~NBPORTES, data&#x3D;tableFinal_np, col&#x3D;c(&quot;red&quot;,&quot;blue&quot;))</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_108_0.png\" alt=\"png\"></p>\n<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_108_2.png\" alt=\"png\"></p>\n<pre><code>Warning message:\n&quot;Ignoring unknown parameters: bins&quot;\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_108_4.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_108_5.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_108_6.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_108_7.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_108_8.png\" alt=\"png\"></p>\n<h3 id=\"划分训练集和验证集-2\"><a href=\"#划分训练集和验证集-2\" class=\"headerlink\" title=\"划分训练集和验证集\"></a>划分训练集和验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">NBPORTES_EA &lt;- tableFinal_np[1:7388,]\nNBPORTES_ET &lt;- tableFinal_np[7389:11082,]</code></pre>\n\n<h3 id=\"应用三种决策树和五种机器学习算法-1\"><a href=\"#应用三种决策树和五种机器学习算法-1\" class=\"headerlink\" title=\"应用三种决策树和五种机器学习算法\"></a>应用三种决策树和五种机器学习算法</h3><p>和之前价格的例子一样，我们对该训练集应用三种决策树和五种机器学习算法</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">NBPORTESTree1&lt;-rpart(NBPORTES~., NBPORTES_EA)\nNBPORTESTree2&lt;-C5.0(NBPORTES~., NBPORTES_EA)\nNBPORTESTree3&lt;-tree(NBPORTES~., data&#x3D;NBPORTES_EA)\nrfNP&lt;-randomForest(NBPORTES~., NBPORTES_EA)\nsvmNP&lt;-svm(NBPORTES~., NBPORTES_EA,probability&#x3D;TRUE)\nnbNP&lt;-naive_bayes(NBPORTES~., NBPORTES_EA)\nnnNP&lt;-nnet(NBPORTES~., NBPORTES_EA,size&#x3D;12)\nknnNP&lt;-kknn(NBPORTES~., NBPORTES_EA,NBPORTES_ET)</code></pre>\n\n<h3 id=\"将学习好的模型应用于验证集-1\"><a href=\"#将学习好的模型应用于验证集-1\" class=\"headerlink\" title=\"将学习好的模型应用于验证集\"></a>将学习好的模型应用于验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 应用于验证集，k近邻算法在训练时已经得到了结果\npredNBPORTES.tree1 &lt;- predict(NBPORTESTree1, NBPORTES_ET, type&#x3D;&quot;vector&quot;)\npredNBPORTES.tree2 &lt;- predict(NBPORTESTree2, NBPORTES_ET, type&#x3D;&quot;class&quot;)\npredNBPORTES.tree3 &lt;- predict(NBPORTESTree3, NBPORTES_ET, type&#x3D;&quot;class&quot;)\nrf_classNP&lt;-predict(rfNP,NBPORTES_EA,type &#x3D; &quot;response&quot;)\nsvm_classNP&lt;-predict(svmNP,NBPORTES_ET,type &#x3D; &quot;response&quot;)\nnbNP_class&lt;-predict(nbNP,NBPORTES_ET,type &#x3D; &quot;class&quot;)\nnnNP_class&lt;-predict(nnNP,NBPORTES_ET, TYPE&#x3D;&quot;class&quot;)</code></pre>\n\n<h3 id=\"混淆矩阵对比-1\"><a href=\"#混淆矩阵对比-1\" class=\"headerlink\" title=\"混淆矩阵对比\"></a>混淆矩阵对比</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">table(NBPORTES_ET$NBPORTES,predNBPORTES.tree1)\ntable(NBPORTES_ET$NBPORTES,predNBPORTES.tree2)\ntable(NBPORTES_ET$NBPORTES,predNBPORTES.tree3)\ntable(NBPORTES_EA$NBPORTES,rf_classNP)\ntable(NBPORTES_ET$NBPORTES,svm_classNP)\ntable(NBPORTES_ET$NBPORTES,nbNP_class)\ntable(NBPORTES_ET$NBPORTES,nnNP_class)\ntable(NBPORTES_ET$NBPORTES,knnNP$fitted.values)</code></pre>\n\n\n<pre><code>   predNBPORTES.tree1\n    1.63414634146341 1.8323782234957 1.99980525803311    2\n  3               31              58                2    0\n  5               65             275             2518  745\n\n\n\n   predNBPORTES.tree2\n       1    2\n  3    0   91\n  5    0 3603\n\n\n\n   predNBPORTES.tree3\n       1    2\n  3    0   91\n  5    0 3603\n\n\n\n   rf_classNP\n       1    2\n  1   24  154\n  2    0 7210\n\n\n\n   svm_classNP\n       1    2\n  3    0   91\n  5    0 3603\n\n\n\n   nbNP_class\n       1    2\n  3   64   27\n  5  268 3335\n\n\n\n   nnNP_class\n    0.975906842537507\n  3                91\n  5              3603\n\n\n\n   \n       1    2\n  3    9   82\n  5   34 3569\n</code></pre>\n<h3 id=\"ROC曲线和AUC对比-1\"><a href=\"#ROC曲线和AUC对比-1\" class=\"headerlink\" title=\"ROC曲线和AUC对比\"></a>ROC曲线和AUC对比</h3><p>在画出ROC曲线前，我们需要把所有的模型转成概率形式</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">pNP.tree1&lt;-predict(NBPORTESTree1,NBPORTES_ET,type &#x3D; &quot;vector&quot;)\nrocNP.pred1&lt;-prediction(pNP.tree1,NBPORTES_ET$NBPORTES)\n\npNP.tree2&lt;-predict(NBPORTESTree2,NBPORTES_ET,type &#x3D; &quot;prob&quot;)\nrocNP.pred2&lt;-prediction(pNP.tree2[,2],NBPORTES_ET$NBPORTES)\n\npNP.tree3&lt;-predict(NBPORTESTree3,NBPORTES_ET,type &#x3D; &quot;vector&quot;)\nrocNP.pred3&lt;-prediction(pNP.tree3[,2],NBPORTES_ET$NBPORTES)\n\nrf_probNP&lt;-predict(rfNP,NBPORTES_ET, type &#x3D; &quot;prob&quot; )\nrf_predNP&lt;-prediction(rf_probNP[,2],NBPORTES_ET$NBPORTES)\n\nsvm_prob&lt;-predict(svmNP,NBPORTES_ET,probability&#x3D;TRUE)\nsvm_prob&lt;-attr(svm_prob,&quot;probabilities&quot;)\nsvm_prob&lt;-as.data.frame(svm_prob)\nsvm_pred&lt;-prediction(svm_prob[,2],NBPORTES_ET$NBPORTES)\n\nnbNP_prob&lt;-predict(nbNP,NBPORTES_ET,type&#x3D;&quot;prob&quot;)\nnbNP_pred&lt;-prediction(nbNP_prob[,2],NBPORTES_ET$NBPORTES)\n\nnnNP_prob&lt;-predict(nnNP,NBPORTES_ET,type &#x3D; &quot;raw&quot;)\nnnNP_pred&lt;-prediction(nnNP_prob,NBPORTES_ET$NBPORTES)\n\nknnNP_prob&lt;-as.data.frame(knnNP$prob)\nknnNP_pred&lt;-prediction(knnNP_prob[,2],NBPORTES_ET$NBPORTES)</code></pre>\n\n<p>然后计算出AUC指数</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">aucNP.tree1&lt;-performance(rocNP.pred1,&quot;auc&quot;)\naucNP.tree2&lt;-performance(rocNP.pred2,&quot;auc&quot;)\naucNP.tree3&lt;-performance(rocNP.pred3,&quot;auc&quot;)\nrf_aucNP&lt;-performance(rf_predNP,&quot;auc&quot;)\nsvm_aucNP&lt;-performance(svm_pred,&quot;auc&quot;)\nnbNP_aucNP&lt;-performance(nbNP_pred,&quot;auc&quot;)\nnnNP_aucNP&lt;-performance(nnNP_pred,&quot;auc&quot;)\nknnNP_aucNP&lt;-performance(knnNP_pred,&quot;auc&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">attr(aucNP.tree1,&quot;y.values&quot;)\nattr(aucNP.tree2,&quot;y.values&quot;)\nattr(aucNP.tree3,&quot;y.values&quot;)\nattr(rf_aucNP,&quot;y.values&quot;)\nattr(svm_aucNP,&quot;y.values&quot;)\nattr(nbNP_aucNP,&quot;y.values&quot;)\nattr(nnNP_aucNP,&quot;y.values&quot;)\nattr(knnNP_aucNP,&quot;y.values&quot;)</code></pre>\n\n\n<ol>\n    <li>0.951351590402381</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.5</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.903157625056043</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.891982566420535</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.0633049991917602</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.93451122843296</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.5</li>\n</ol>\n\n\n\n\n<ol>\n    <li>0.85450006557417</li>\n</ol>\n\n\n\n<h3 id=\"画出ROC曲线，根据AUC指数选择该标签最适合的算法-1\"><a href=\"#画出ROC曲线，根据AUC指数选择该标签最适合的算法-1\" class=\"headerlink\" title=\"画出ROC曲线，根据AUC指数选择该标签最适合的算法\"></a>画出ROC曲线，根据AUC指数选择该标签最适合的算法</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">rocNP.pref1&lt;-performance(rocNP.pred1,&quot;tpr&quot;,&quot;fpr&quot;)\nrocNP.pref2&lt;-performance(rocNP.pred2,&quot;tpr&quot;,&quot;fpr&quot;)  \nrocNP.pref3&lt;-performance(rocNP.pred3,&quot;tpr&quot;,&quot;fpr&quot;) \nrf_prefNP&lt;-performance(rf_predNP,&quot;tpr&quot;,&quot;fpr&quot;)\nsvm_pref&lt;-performance(rf_predNP,&quot;tpr&quot;,&quot;fpr&quot;)\nnbNP_pref&lt;-performance(nbNP_pred,&quot;tpr&quot;,&quot;fpr&quot;)\nnnNP_pref&lt;-performance(nnNP_pred,&quot;tpr&quot;,&quot;fpr&quot;)\nknnNP_pref&lt;-performance(knnNP_pred,&quot;tpr&quot;,&quot;fpr&quot;)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">plot(rocNP.pref1,col&#x3D;&quot;green&quot;)\nplot(rocNP.pref2,add &#x3D; TRUE,col&#x3D;&quot;blue&quot;)\nplot(rocNP.pref3,add &#x3D; TRUE,col&#x3D;&quot;red&quot;)\nplot(rf_prefNP,add &#x3D; TRUE, col&#x3D;&quot;yellow&quot;)\nplot(svm_pref,add &#x3D; TRUE, col&#x3D;&quot;black&quot;)\nplot(nbNP_pref,add &#x3D; TRUE, col&#x3D;&quot;purple&quot;)\nplot(nnNP_pref,add &#x3D; TRUE, col&#x3D;&quot;orange&quot;)\nplot(nnNP_pref,add &#x3D; TRUE, col&#x3D;&quot;black&quot;)</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_124_0.png\" alt=\"png\"></p>\n<h3 id=\"将表现最好的模型应用于将要预测的数据集-2\"><a href=\"#将表现最好的模型应用于将要预测的数据集-2\" class=\"headerlink\" title=\"将表现最好的模型应用于将要预测的数据集\"></a>将表现最好的模型应用于将要预测的数据集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">class.treerpartNB &lt;- predict(nbNP, tableMar, probability&#x3D;TRUE)\nresultatNB &lt;- data.frame(tableMar, class.treerpartNB)\n\n# Renommage de la colonne des classes predites\nnames(resultatNB)[7] &lt;- &quot;NBPORTES&quot;</code></pre>\n\n<h2 id=\"Longueur车长\"><a href=\"#Longueur车长\" class=\"headerlink\" title=\"Longueur车长\"></a>Longueur车长</h2><h3 id=\"数据准备-3\"><a href=\"#数据准备-3\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h3><p>取Immatriculation第四九列，可以得到车牌号对应车的车长</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableImLG &lt;- tableIm_f[c(4, 9)]\ntableLGFinal &lt;- merge(tableClients, tableImLG, by &#x3D; &quot;IMMATRICULATION&quot;, incomparables &#x3D; NA)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">## 更改变量类型\nstr(tableLGFinal)\ntableLGFinal$TAUX &lt;- as.integer(tableLGFinal$TAUX)\n## 剔除不需要的列\ntableLGFinal &lt;- subset(tableLGFinal, select&#x3D;-IMMATRICULATION)</code></pre>\n\n<pre><code>&#39;data.frame&#39;:    11082 obs. of  8 variables:\n $ IMMATRICULATION   : chr  &quot;1 EF 20&quot; &quot;10 ZM 12&quot; &quot;100 XL 72&quot; &quot;100 YT 70&quot; ...\n $ AGE               : num  18 33 26 76 20 27 45 28 28 38 ...\n $ SEXE              : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ...\n $ TAUX              : chr  &quot;594&quot; &quot;1380&quot; &quot;597&quot; &quot;587&quot; ...\n $ SITUATIONFAMILIALE: chr  &quot;celibataire&quot; &quot;En Couple&quot; &quot;En Couple&quot; &quot;En Couple&quot; ...\n $ NBENFANTSACHARGE  : num  0 4 0 1 0 0 0 2 2 0 ...\n $ DEUXIEMEVOITURE   : chr  &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; ...\n $ LONGUEUR          : chr  &quot;moyenne&quot; &quot;tres longue&quot; &quot;tres longue&quot; &quot;tres longue&quot; ...\n</code></pre>\n<h3 id=\"可视化数据-3\"><a href=\"#可视化数据-3\" class=\"headerlink\" title=\"可视化数据\"></a>可视化数据</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 从可视化可以大致看出相关性，如果变量相关性很好，那么出来的模型准确率越高\nlibrary(ggplot2)\nqplot(LONGUEUR, data&#x3D;tableLGFinal)\ntable(tableLGFinal$DEUXIEMEVOITURE,tableLGFinal$LONGUEUR)\nqplot(DEUXIEMEVOITURE, data&#x3D;tableLGFinal, color&#x3D;LONGUEUR)</code></pre>\n\n\n\n<pre><code>        courte longue moyenne tres longue\n  FALSE   2569   3009     777        3329\n  TRUE     944      0       0         454\n</code></pre>\n<p><img src=\"/source/img/Rprojet/output_132_1.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_132_2.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">qplot(TAUX, data&#x3D;tableLGFinal, fill&#x3D;LONGUEUR, bins &#x3D;5)\nboxplot(AGE~LONGUEUR, data&#x3D;tableLGFinal, col&#x3D;c(&quot;red&quot;,&quot;blue&quot;))</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_133_0.png\" alt=\"png\"></p>\n<p><img src=\"/source/img/Rprojet/output_133_1.png\" alt=\"png\"></p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">qplot(SEXE, data&#x3D;tableLGFinal, color&#x3D;LONGUEUR)</code></pre>\n\n\n\n<p><img src=\"/source/img/Rprojet/output_134_0.png\" alt=\"png\"></p>\n<h3 id=\"划分训练集和验证集-3\"><a href=\"#划分训练集和验证集-3\" class=\"headerlink\" title=\"划分训练集和验证集\"></a>划分训练集和验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">LG_EA &lt;- tableLGFinal[1:7388,]\nLG_ET &lt;- tableLGFinal[7389:11082,]\nLG_EA$LONGUEUR &lt;- as.factor(LG_EA$LONGUEUR)</code></pre>\n\n<h3 id=\"应用三种决策树和五种机器学习算法-2\"><a href=\"#应用三种决策树和五种机器学习算法-2\" class=\"headerlink\" title=\"应用三种决策树和五种机器学习算法\"></a>应用三种决策树和五种机器学习算法</h3><p>和之前价格的例子一样，我们对该训练集应用三种决策树和五种机器学习算法</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">LGtree1 &lt;- rpart(LONGUEUR~., LG_EA)\nLGtree2 &lt;- C5.0(LONGUEUR~., LG_EA)\nLGtree3 &lt;- tree(LONGUEUR~., data&#x3D;LG_EA)\nrfLG &lt;- randomForest(LONGUEUR~., LG_EA)\nsvmLG &lt;- svm(LONGUEUR~., LG_EA, probability&#x3D;TRUE)\nnbLG &lt;- naive_bayes(LONGUEUR~., LG_EA)\nnnLG &lt;- nnet(LONGUEUR~., LG_EA, size&#x3D;12)\nknnLG &lt;- kknn(LONGUEUR~., LG_EA, LG_ET)</code></pre>\n\n<pre><code>Warning message in tree(LONGUEUR ~ ., data = LG_EA):\n&quot;强制改变过程中产生了NA&quot;\nWarning message:\n&quot;naive_bayes(): Feature SITUATIONFAMILIALE - zero probabilities are present. Consider Laplace smoothing.&quot;\nWarning message:\n&quot;naive_bayes(): Feature DEUXIEMEVOITURE - zero probabilities are present. Consider Laplace smoothing.&quot;\n\n\n# weights:  184\ninitial  value 12969.213412 \niter  10 value 9469.911371\niter  20 value 9305.689396\niter  30 value 8970.449826\niter  40 value 8689.100430\niter  50 value 8419.405933\niter  60 value 8266.730127\niter  70 value 8167.329971\niter  80 value 7592.378033\niter  90 value 7546.309856\niter 100 value 7458.459896\nfinal  value 7458.459896 \nstopped after 100 iterations\n</code></pre>\n<h3 id=\"将学习好的模型应用于验证集-2\"><a href=\"#将学习好的模型应用于验证集-2\" class=\"headerlink\" title=\"将学习好的模型应用于验证集\"></a>将学习好的模型应用于验证集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">predLG.tree1 &lt;- predict(LGtree1, LG_ET, type&#x3D;&quot;class&quot;)\npredLG.tree2 &lt;- predict(LGtree2, LG_ET, type&#x3D;&quot;class&quot;)\npredLG.tree3 &lt;- predict(LGtree3, LG_ET, type&#x3D;&quot;class&quot;)\nresult.rfLG &lt;- predict(rfLG,LG_ET, type&#x3D;&quot;response&quot;)\nresult.svmLG &lt;- predict(svmLG,LG_ET, type&#x3D;&quot;response&quot;)\nresult.treeNaiveLG &lt;- predict(nbLG,LG_ET, type&#x3D;&quot;class&quot;)\nresult.treeNnetLG &lt;- predict(nnLG, LG_ET,type&#x3D;&quot;class&quot;)</code></pre>\n\n<pre><code>Warning message in pred1.tree(object, tree.matrix(newdata)):\n&quot;强制改变过程中产生了NA&quot;\nWarning message:\n&quot;predict.naive_bayes(): more features in the newdata are provided as there are probability tables in the object. Calculation is performed based on features to be found in the tables.&quot;\n</code></pre>\n<h3 id=\"混淆矩阵对比-2\"><a href=\"#混淆矩阵对比-2\" class=\"headerlink\" title=\"混淆矩阵对比\"></a>混淆矩阵对比</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">table(LG_ET$LONGUEUR, predLG.tree1)\ntable(LG_ET$LONGUEUR, predLG.tree2)\ntable(LG_ET$LONGUEUR, predLG.tree3)\ntable(LG_ET$LONGUEUR, result.rfLG)\ntable(LG_ET$LONGUEUR, result.svmLG)\ntable(LG_ET$LONGUEUR, result.treeNaiveLG)\ntable(LG_ET$LONGUEUR, result.treeNnetLG)\ntable(LG_ET$LONGUEUR, knnLG$fitted.values)</code></pre>\n\n\n<pre><code>             predLG.tree1\n              courte longue moyenne tres longue\n  courte        1166      1       0           1\n  longue           1   1021       0           0\n  moyenne        270      0       0           0\n  tres longue      1    493       0         740\n\n\n\n             predLG.tree2\n              courte longue moyenne tres longue\n  courte        1166      1       0           1\n  longue           1   1021       0           0\n  moyenne        270      0       0           0\n  tres longue      1    493       0         740\n\n\n\n             predLG.tree3\n              courte longue moyenne tres longue\n  courte         940    227       0           1\n  longue         304    675       0          43\n  moyenne        270      0       0           0\n  tres longue    163    310       0         761\n\n\n\n             result.rfLG\n              courte longue moyenne tres longue\n  courte        1156      1      10           1\n  longue           1   1015       0           6\n  moyenne        261      0       9           0\n  tres longue      1    493       0         740\n\n\n\n             result.svmLG\n              courte longue moyenne tres longue\n  courte        1166      1       0           1\n  longue           2   1020       0           0\n  moyenne        270      0       0           0\n  tres longue      1    493       0         740\n\n\n\n             result.treeNaiveLG\n              courte longue moyenne tres longue\n  courte         332      0     684         152\n  longue          12    661       2         347\n  moyenne          5      0     265           0\n  tres longue      7    320       0         907\n\n\n\n             result.treeNnetLG\n              courte tres longue\n  courte        1043         125\n  longue         406         616\n  moyenne        270           0\n  tres longue    209        1025\n\n\n\n             \n              courte longue moyenne tres longue\n  courte        1063      1     103           1\n  longue           1    744       0         277\n  moyenne        154      0     116           0\n  tres longue      2    355       0         877\n</code></pre>\n<h3 id=\"可视化决策树结构\"><a href=\"#可视化决策树结构\" class=\"headerlink\" title=\"可视化决策树结构\"></a>可视化决策树结构</h3><p>其实其他五种结构都能查看，这里我就不去运行了</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">prp(LGtree1, type&#x3D;4, extra&#x3D;1, box.col&#x3D;c(&quot;tomato&quot;, &quot;skyblue&quot;)[LGtree1$frame$yval])\nplot(LGtree2, type&#x3D;&quot;simple&quot;)\nplot(LGtree3)\ntext(LGtree3, pretty&#x3D;0)</code></pre>\n\n<h3 id=\"将表现最好的模型应用于将要预测的数据集-3\"><a href=\"#将表现最好的模型应用于将要预测的数据集-3\" class=\"headerlink\" title=\"将表现最好的模型应用于将要预测的数据集\"></a>将表现最好的模型应用于将要预测的数据集</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">#&#x3D;&#x3D;&#x3D; rpart &#x3D;&#x3D;&#x3D;#\nclass.treerpLG &lt;- predict(LGtree1, tableMar, type&#x3D;&quot;class&quot;)\n\nresultatLG &lt;- data.frame(tableMar, class.treerpLG)\n\n# Renommage de la colonne des classes predites\nnames(resultatLG)[7] &lt;- &quot;LONGUEUR&quot;</code></pre>\n\n<h2 id=\"Couleur颜色\"><a href=\"#Couleur颜色\" class=\"headerlink\" title=\"Couleur颜色\"></a>Couleur颜色</h2><h3 id=\"数据准备-4\"><a href=\"#数据准备-4\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h3><p>取Immatriculation第六九列，可以得到车牌号对应车的车长</p>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">tableImCL &lt;- tableIm_f[c(6, 9)]\ntableCLFinal &lt;- merge(tableClients, tableImCL, by &#x3D; &quot;IMMATRICULATION&quot;, incomparables &#x3D; NA)</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">summary(tableCLFinal$COULEUR)</code></pre>\n\n\n<pre><code>   Length     Class      Mode \n    11082 character character \n</code></pre>\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">str(tableCLFinal)\ntableCLFinal$TAUX &lt;- as.integer(tableCLFinal$TAUX)\ntableCLFinal &lt;- subset(tableCLFinal, select&#x3D;-IMMATRICULATION)</code></pre>\n\n<pre><code>&#39;data.frame&#39;:    11082 obs. of  8 variables:\n $ IMMATRICULATION   : chr  &quot;1 EF 20&quot; &quot;10 ZM 12&quot; &quot;100 XL 72&quot; &quot;100 YT 70&quot; ...\n $ AGE               : num  18 33 26 76 20 27 45 28 28 38 ...\n $ SEXE              : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ...\n $ TAUX              : chr  &quot;594&quot; &quot;1380&quot; &quot;597&quot; &quot;587&quot; ...\n $ SITUATIONFAMILIALE: chr  &quot;celibataire&quot; &quot;En Couple&quot; &quot;En Couple&quot; &quot;En Couple&quot; ...\n $ NBENFANTSACHARGE  : num  0 4 0 1 0 0 0 2 2 0 ...\n $ DEUXIEMEVOITURE   : chr  &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; ...\n $ COULEUR           : chr  &quot;bleu&quot; &quot;gris&quot; &quot;bleu&quot; &quot;gris&quot; ...\n</code></pre>\n<h3 id=\"数据可视化\"><a href=\"#数据可视化\" class=\"headerlink\" title=\"数据可视化\"></a>数据可视化</h3><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">table(tableOCCAFinal$DEUXIEMEVOITURE,tableOCCAFinal$OCCASION)</code></pre>\n\n\n\n<pre><code>        FALSE TRUE\n  FALSE  8408 1276\n  TRUE   1234  164\n</code></pre>\n<p>可视化后发现该变量和各参数没有太大的相关性，故而不做分析。<br><img src=\"/source/img/Rprojet/63.png\" alt=\"png\"><br><img src=\"/source/img/Rprojet/64.png\" alt=\"png\"><br><img src=\"/source/img/Rprojet/65.png\" alt=\"png\"><br><img src=\"/source/img/Rprojet/66.png\" alt=\"png\"></p>\n<h2 id=\"整合模型应用于将要预测的数据集\"><a href=\"#整合模型应用于将要预测的数据集\" class=\"headerlink\" title=\"整合模型应用于将要预测的数据集\"></a>整合模型应用于将要预测的数据集</h2><pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\">resultatTOTAL &lt;- data.frame(tableMar, resultatLG[7],resultatNB[7],resultatOCCA[7],resultatPrix[7])</code></pre>\n\n\n<pre class=\"line-numbers language-R\" data-language=\"R\"><code class=\"language-R\"># 将结果整合到xlsx格式文件中\ninstall.packages(&quot;openxlsx&quot;) \nlibrary(openxlsx)\nwrite.xlsx(resultatTOTAL,&quot;predictions.xlsx&quot;)</code></pre>\n\n\n\n","text":"前言首先，R语言牛皮之处就不过多阐述，总之很方便很方便。R语言就是为了数据处理而生的，可以轻松链接数据库，可以轻松对数据进行处理和分析。 这篇博客主要归纳一下如何使用R语言搭建一个简单的推荐系统。首先导入包： #install.packages(&quot;RJDBC&quot;...","link":"","photos":[],"count_time":{"symbolsCount":"43k","symbolsTime":"39 mins."},"categories":[{"name":"机器学习Machine Learning","slug":"机器学习Machine-Learning","count":3,"path":"api/categories/机器学习Machine-Learning.json"}],"tags":[{"name":"机器学习","slug":"机器学习","count":3,"path":"api/tags/机器学习.json"},{"name":"推荐系统","slug":"推荐系统","count":3,"path":"api/tags/推荐系统.json"},{"name":"R语言","slug":"R语言","count":1,"path":"api/tags/R语言.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%93%BE%E6%8E%A5Oracle%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">链接Oracle数据库</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">数据</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%A1%AE%E5%AE%9A%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">确定标签</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Prix%E4%BB%B7%E6%A0%BC\"><span class=\"toc-text\">Prix价格</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">可视化数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%92%E5%88%86%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86\"><span class=\"toc-text\">划分训练集和验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AF%94%E8%BE%83%E4%B8%89%E7%A7%8D%E5%86%B3%E7%AD%96%E6%A0%91%E7%9A%84%E6%80%A7%E8%83%BD\"><span class=\"toc-text\">比较三种决策树的性能</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97\"><span class=\"toc-text\">随机森林</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA\"><span class=\"toc-text\">支持向量机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF\"><span class=\"toc-text\">朴素贝叶斯</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C\"><span class=\"toc-text\">神经网络</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#K%E8%BF%91%E9%82%BB\"><span class=\"toc-text\">K近邻</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E8%A1%A8%E7%8E%B0%E6%9C%80%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E5%B0%86%E8%A6%81%E9%A2%84%E6%B5%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86\"><span class=\"toc-text\">将表现最好的模型应用于将要预测的数据集</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Occasion%E4%BA%8C%E6%89%8B\"><span class=\"toc-text\">Occasion二手</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-1\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">可视化数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%92%E5%88%86%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86-1\"><span class=\"toc-text\">划分训练集和验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BA%94%E7%94%A8%E4%B8%89%E7%A7%8D%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E4%BA%94%E7%A7%8D%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95\"><span class=\"toc-text\">应用三种决策树和五种机器学习算法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E5%AD%A6%E4%B9%A0%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E9%AA%8C%E8%AF%81%E9%9B%86\"><span class=\"toc-text\">将学习好的模型应用于验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">混淆矩阵对比</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ROC%E6%9B%B2%E7%BA%BF%E5%92%8CAUC%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">ROC曲线和AUC对比</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%BB%E5%87%BAROC%E6%9B%B2%E7%BA%BF%EF%BC%8C%E6%A0%B9%E6%8D%AEAUC%E6%8C%87%E6%95%B0%E9%80%89%E6%8B%A9%E8%AF%A5%E6%A0%87%E7%AD%BE%E6%9C%80%E9%80%82%E5%90%88%E7%9A%84%E7%AE%97%E6%B3%95\"><span class=\"toc-text\">画出ROC曲线，根据AUC指数选择该标签最适合的算法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E8%A1%A8%E7%8E%B0%E6%9C%80%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E5%B0%86%E8%A6%81%E9%A2%84%E6%B5%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86-1\"><span class=\"toc-text\">将表现最好的模型应用于将要预测的数据集</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#NBPortes%E8%BD%A6%E9%97%A8%E6%95%B0%E9%87%8F\"><span class=\"toc-text\">NBPortes车门数量</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-2\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">可视化数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%92%E5%88%86%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86-2\"><span class=\"toc-text\">划分训练集和验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BA%94%E7%94%A8%E4%B8%89%E7%A7%8D%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E4%BA%94%E7%A7%8D%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95-1\"><span class=\"toc-text\">应用三种决策树和五种机器学习算法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E5%AD%A6%E4%B9%A0%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E9%AA%8C%E8%AF%81%E9%9B%86-1\"><span class=\"toc-text\">将学习好的模型应用于验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E5%AF%B9%E6%AF%94-1\"><span class=\"toc-text\">混淆矩阵对比</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ROC%E6%9B%B2%E7%BA%BF%E5%92%8CAUC%E5%AF%B9%E6%AF%94-1\"><span class=\"toc-text\">ROC曲线和AUC对比</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%BB%E5%87%BAROC%E6%9B%B2%E7%BA%BF%EF%BC%8C%E6%A0%B9%E6%8D%AEAUC%E6%8C%87%E6%95%B0%E9%80%89%E6%8B%A9%E8%AF%A5%E6%A0%87%E7%AD%BE%E6%9C%80%E9%80%82%E5%90%88%E7%9A%84%E7%AE%97%E6%B3%95-1\"><span class=\"toc-text\">画出ROC曲线，根据AUC指数选择该标签最适合的算法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E8%A1%A8%E7%8E%B0%E6%9C%80%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E5%B0%86%E8%A6%81%E9%A2%84%E6%B5%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86-2\"><span class=\"toc-text\">将表现最好的模型应用于将要预测的数据集</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Longueur%E8%BD%A6%E9%95%BF\"><span class=\"toc-text\">Longueur车长</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-3\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE-3\"><span class=\"toc-text\">可视化数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%92%E5%88%86%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86-3\"><span class=\"toc-text\">划分训练集和验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BA%94%E7%94%A8%E4%B8%89%E7%A7%8D%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E4%BA%94%E7%A7%8D%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95-2\"><span class=\"toc-text\">应用三种决策树和五种机器学习算法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E5%AD%A6%E4%B9%A0%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E9%AA%8C%E8%AF%81%E9%9B%86-2\"><span class=\"toc-text\">将学习好的模型应用于验证集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E5%AF%B9%E6%AF%94-2\"><span class=\"toc-text\">混淆矩阵对比</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%86%B3%E7%AD%96%E6%A0%91%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">可视化决策树结构</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%86%E8%A1%A8%E7%8E%B0%E6%9C%80%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E5%B0%86%E8%A6%81%E9%A2%84%E6%B5%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86-3\"><span class=\"toc-text\">将表现最好的模型应用于将要预测的数据集</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Couleur%E9%A2%9C%E8%89%B2\"><span class=\"toc-text\">Couleur颜色</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-4\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96\"><span class=\"toc-text\">数据可视化</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B4%E5%90%88%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E4%BA%8E%E5%B0%86%E8%A6%81%E9%A2%84%E6%B5%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86\"><span class=\"toc-text\">整合模型应用于将要预测的数据集</span></a></li></ol>","author":{"name":"Quanito","slug":"blog-author","avatar":"/staticImg/avatar.jpg","link":"/","description":"大道五十，天衍四十九，人遁其一","socials":{"github":"https://github.com/1250681923","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"GoogleMail":{"icon":"/img/email.png","link":"mailto:code.quan666zhang@gmail.com"}}}},"mapped":true,"prev_post":{"title":"DLNotes","uid":"939229761d9e9e6b8785ea116cde36b3","slug":"深度学习笔记","date":"2022-08-01T14:10:05.000Z","updated":"2024-11-06T02:24:29.757Z","comments":true,"path":"api/articles/深度学习笔记.json","keywords":null,"cover":"/img/ai.jpg","text":"iris-鸢尾花# 导入相关的库 import seaborn as sns import numpy as np # 机器学习：sklearn from sklearn.model_selection import train_test_split from sklearn.l...","link":"","photos":[],"count_time":{"symbolsCount":"89k","symbolsTime":"1:21"},"categories":[{"name":"Deep Learning","slug":"Deep-Learning","count":2,"path":"api/categories/Deep-Learning.json"}],"tags":[{"name":"深度学习","slug":"深度学习","count":2,"path":"api/tags/深度学习.json"},{"name":"DLNotes分类","slug":"DLNotes分类","count":1,"path":"api/tags/DLNotes分类.json"}],"author":{"name":"Quanito","slug":"blog-author","avatar":"/staticImg/avatar.jpg","link":"/","description":"大道五十，天衍四十九，人遁其一","socials":{"github":"https://github.com/1250681923","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"GoogleMail":{"icon":"/img/email.png","link":"mailto:code.quan666zhang@gmail.com"}}}}},"next_post":{"title":"pdf提取关键词-词频统计","uid":"edb5c2518fc05606a5ee5737b98e178c","slug":"pdf提取关键词-词频统计","date":"2022-03-17T16:39:10.000Z","updated":"2024-11-06T02:24:29.746Z","comments":true,"path":"api/articles/pdf提取关键词-词频统计.json","keywords":null,"cover":"/img/ai.jpg","text":"项目背景这个算是之前帮助同事解决的一个小问题。因为所在公司为外企，有大量没有归类的英文pdf文档。所以需求就是给所有的pdf生成关键词，放在txt文件或者excel文件中，方便后续的查找。 项目仓库地址 需求分析生成关键词的话，需要对词频有一个统计，然后过滤掉没有意义且频率较大的...","link":"","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"自然语言处理NLP","slug":"自然语言处理NLP","count":1,"path":"api/categories/自然语言处理NLP.json"}],"tags":[{"name":"自然语言处理","slug":"自然语言处理","count":1,"path":"api/tags/自然语言处理.json"},{"name":"词频统计","slug":"词频统计","count":1,"path":"api/tags/词频统计.json"},{"name":"关键词","slug":"关键词","count":1,"path":"api/tags/关键词.json"},{"name":"NLP","slug":"NLP","count":1,"path":"api/tags/NLP.json"}],"author":{"name":"Quanito","slug":"blog-author","avatar":"/staticImg/avatar.jpg","link":"/","description":"大道五十，天衍四十九，人遁其一","socials":{"github":"https://github.com/1250681923","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"GoogleMail":{"icon":"/img/email.png","link":"mailto:code.quan666zhang@gmail.com"}}}}}}